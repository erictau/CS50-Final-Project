{% extends "layout.html" %}

{% block title %} 
    Home 
{% endblock %} 

{% block main %}
<div class="confirmation-msg"> {{ message }}</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"></script>
<div class="container-fluid charts">
  <div class="text-center lead pt-3 pb-1">
    <strong>Remaining Budget</strong>
  </div> 
    <canvas id="myChart" name="myChart" style="width:100%; max-width:700px; margin:auto"></canvas>
</div>

<!-- Budget Table -->
<div class="container-fluid">
  <div class="text-center lead pt-3 pb-1">
    <strong>Budget Table</strong>
  </div>
  <div class="container m-auto p-1 table-responsive-md">
    <table class="table table-striped table-hover">
      <thead>
        <tr>
          <th>Letter</th>
          <th>Description</th>
          <th>Original Amount</th>
          <th>Amount Spent</th>
          <th>Amount Remaining</th>
        </tr>
      </thead>
      <tbody>
        {% for row in budgets %}
        <tr>
          <td> {{ row['letters'] }}  </td>
          <td> {{ row['description'] }} </td>
          <td> {{ row['original_amount'] | usd }} </td>
          <td> {{ row['amount_spent'] | usd}} </td>
          <td> {{ row['amount'] | usd}} </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<!-- ChartJS configuration script-->
<script>
    var xValues = [];
    var yValues = [];
    var yOriginalValues = [];
    var barColors = [];

    '{% for x in xVals %}'
        xValues.push('{{ x }}');
    '{% endfor %}'

    '{% for y in yVals %}'
        yValues.push('{{ y }}');
    '{% endfor %}'

    '{% for yOrig in yOriginalValues %}'
        yOriginalValues.push('{{ yOrig }}');
    '{% endfor %}'
    
    '{% for color in colors %}'
        barColors.push('{{ color }}');
    '{% endfor %}'
    
    console.log(xValues);
    console.log(yValues);
    console.log(yOriginalValues);
    console.log(barColors);
    
    var data = {
      labels: xValues,
      datasets: [
        {
          label: "Original",
          backgroundColor: "blue",
          data: yOriginalValues
        },
        {
          label: "Remaining",
          backgroundColor: "grey",
          data: yValues
        }
      ]
    }

    new Chart("myChart", {
      type: "bar",
      data: data,
      options: 
      {
        scales: 
        {
          xAxes: 
          [{
            barPercentage: 0.7,
            categoryPercentage: 0.5
          }],
          yAxes: 
          [{
            ticks: 
            {
              min: 0
            }
          }]
        },
      }
    });
</script>
    
{% endblock %}
